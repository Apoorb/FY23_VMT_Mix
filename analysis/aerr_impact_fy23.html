<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.290">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Apoorb">
<meta name="dcterms.date" content="2023-03-28">

<title>Test the 2020 AERR emission quantity sensitivity b/w old and new VMT Mix</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="aerr_impact_fy23_files/libs/clipboard/clipboard.min.js"></script>
<script src="aerr_impact_fy23_files/libs/quarto-html/quarto.js"></script>
<script src="aerr_impact_fy23_files/libs/quarto-html/popper.min.js"></script>
<script src="aerr_impact_fy23_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="aerr_impact_fy23_files/libs/quarto-html/anchor.min.js"></script>
<link href="aerr_impact_fy23_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="aerr_impact_fy23_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="aerr_impact_fy23_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="aerr_impact_fy23_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="aerr_impact_fy23_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#housekeeping" id="toc-housekeeping" class="nav-link active" data-scroll-target="#housekeeping">Housekeeping</a></li>
  <li><a href="#process-aerr20-sut-ft-emission-and-activity-to-get-county-level-vmt-and-emission-rates" id="toc-process-aerr20-sut-ft-emission-and-activity-to-get-county-level-vmt-and-emission-rates" class="nav-link" data-scroll-target="#process-aerr20-sut-ft-emission-and-activity-to-get-county-level-vmt-and-emission-rates">Process AERR20 SUT-FT Emission and Activity to get County-level VMT and Emission Rates</a>
  <ul class="collapse">
  <li><a href="#get-county-level-vmt-and-filter-to-vmt-activity." id="toc-get-county-level-vmt-and-filter-to-vmt-activity." class="nav-link" data-scroll-target="#get-county-level-vmt-and-filter-to-vmt-activity.">Get county-level VMT and filter to VMT activity.</a></li>
  <li><a href="#back-calculate-emission-on-raod-emission-rate." id="toc-back-calculate-emission-on-raod-emission-rate." class="nav-link" data-scroll-target="#back-calculate-emission-on-raod-emission-rate.">Back-calculate Emission On-raod Emission Rate.</a></li>
  </ul></li>
  <li><a href="#load-fy22-and-f23-vmt-mix-created-by-axb" id="toc-load-fy22-and-f23-vmt-mix-created-by-axb" class="nav-link" data-scroll-target="#load-fy22-and-f23-vmt-mix-created-by-axb">Load FY22 and F23 VMT-Mix Created by AxB</a></li>
  <li><a href="#merge-aerr-2020-processed-data-with-new-vmt-mixes" id="toc-merge-aerr-2020-processed-data-with-new-vmt-mixes" class="nav-link" data-scroll-target="#merge-aerr-2020-processed-data-with-new-vmt-mixes">Merge AERR 2020 Processed Data with New VMT-Mixes</a>
  <ul class="collapse">
  <li><a href="#get-contribution-of-different-sut-ft-for-overall-emissions" id="toc-get-contribution-of-different-sut-ft-for-overall-emissions" class="nav-link" data-scroll-target="#get-contribution-of-different-sut-ft-for-overall-emissions">Get contribution of different SUT-FT for overall emissions</a></li>
  </ul></li>
  <li><a href="#tables-and-figures-emission-and-vmt" id="toc-tables-and-figures-emission-and-vmt" class="nav-link" data-scroll-target="#tables-and-figures-emission-and-vmt">Tables and Figures Emission and VMT</a>
  <ul class="collapse">
  <li><a href="#statewide-impact" id="toc-statewide-impact" class="nav-link" data-scroll-target="#statewide-impact">Statewide impact</a></li>
  <li><a href="#non-attainment-area-impact" id="toc-non-attainment-area-impact" class="nav-link" data-scroll-target="#non-attainment-area-impact">Non-attainment area impact</a></li>
  </ul></li>
  <li><a href="#county-emission-inc-w.r.t-to-vmt-mix-and-vmt-change-emission-rate" id="toc-county-emission-inc-w.r.t-to-vmt-mix-and-vmt-change-emission-rate" class="nav-link" data-scroll-target="#county-emission-inc-w.r.t-to-vmt-mix-and-vmt-change-emission-rate">County Emission Inc w.r.t to VMT-Mix and VMT Change + Emission Rate</a></li>
  <li><a href="#vmt-mix-comp" id="toc-vmt-mix-comp" class="nav-link" data-scroll-target="#vmt-mix-comp">VMT-Mix Comp</a></li>
  <li><a href="#rpython-example" id="toc-rpython-example" class="nav-link" data-scroll-target="#rpython-example">R+Python Example</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Test the 2020 AERR emission quantity sensitivity b/w old and new VMT Mix</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Apoorb </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">March 28, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="housekeeping" class="level2">
<h2 class="anchored" data-anchor-id="housekeeping">Housekeeping</h2>
<div class="cell" data-execution_count="1">
<pre class="python3 cell-code"><code>import sys
import pathlib
from pathlib import Path
import pandas as pd
import geopandas as gpd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns

sys.path.append(r"C:\Users\a-bibeka\PycharmProjects\FY23_VMT_Mix")
from vmtmix_fy23.utils import path_county_shp
</code></pre>
</div>
<p>Set Paths</p>
<div class="cell" data-execution_count="2">
<pre class="python3 cell-code"><code>path_aerr20_csvs = Path(
    r"E:\Texas A&amp;M Transportation Institute\TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors\Data\fy23_vmt_mix\Input\aerr20_output"
)
path_sutft_act = Path.joinpath(path_aerr20_csvs, "mvs303_act_sutft.csv")
path_sutft_emis = Path.joinpath(path_aerr20_csvs, "mvs303_emis_sutft.csv")
path_vmtmix_fy22_13_19 = Path(
    r"E:\Texas A&amp;M Transportation Institute\TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors\Data\fy23_vmt_mix\output\fy22_fin_vmtmix_13_19_042022.csv"
)

path_vmtmix_fy23_13_21 = Path(
    r"E:\Texas A&amp;M Transportation Institute\TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors\Data\fy23_vmt_mix\output\fy23_fin_vmtmix_13_21_032023.csv"
)
</code></pre>
</div>
<p>Analysis FIPS</p>
<div class="cell" data-execution_count="3">
<pre class="python3 cell-code"><code>gdf_county = gpd.read_file(path_county_shp)
district_map = gdf_county[["TXDOT_DIST", "FIPS_ST_CN"]].astype(int)

hgb_fips = [48201, 48039, 48157, 48473, 48339, 48291, 48071, 48167]
san_fips = [48029, 48091, 48187, 48259, 48493]
hgb_san_fips = list(hgb_fips) + list(san_fips)
fips_254 = list(district_map.FIPS_ST_CN.unique())
analysis_fips = fips_254


district_map_anly = district_map.loc[
    district_map.FIPS_ST_CN.isin(analysis_fips)
].rename(columns={"FIPS_ST_CN": "fips", "TXDOT_DIST": "txdot_dist"})
</code></pre>
</div>
</section>
<section id="process-aerr20-sut-ft-emission-and-activity-to-get-county-level-vmt-and-emission-rates" class="level2">
<h2 class="anchored" data-anchor-id="process-aerr20-sut-ft-emission-and-activity-to-get-county-level-vmt-and-emission-rates">Process AERR20 SUT-FT Emission and Activity to get County-level VMT and Emission Rates</h2>
<div class="cell" data-execution_count="4">
<pre class="python3 cell-code"><code>sutft_act = pd.read_csv(path_sutft_act)
suft_emis = pd.read_csv(path_sutft_emis)
</code></pre>
</div>
<section id="get-county-level-vmt-and-filter-to-vmt-activity." class="level3">
<h3 class="anchored" data-anchor-id="get-county-level-vmt-and-filter-to-vmt-activity.">Get county-level VMT and filter to VMT activity.</h3>
<div class="cell" data-execution_count="5">
<pre class="python3 cell-code"><code>sutft_vmt = sutft_act.loc[sutft_act.mvs_act_type == "vmt"]
sutft_vmt = sutft_vmt.rename(columns={"activity": "vmt"})
sutft_vmt["vmt_agg"] = sutft_vmt.groupby(
    [
        "county",
        "fips",
        "year_id",
        "road_type_id",
        "roadtype_lab",
        "activity_type_id",
        "mvs_act_type",
        "act_em_lab",
    ]
).vmt.transform(sum)
sutft_vmt = sutft_vmt.filter(
    items=[
        "county",
        "fips",
        "year_id",
        "road_type_id",
        "roadtype_lab",
        "activity_type_id",
        "mvs_act_type",
        "source_type_id",
        "fuel_type_id",
        "sut_fueltype_lab",
        "act_em_lab",
        "vmt",
        "vmt_agg",
    ]
)
</code></pre>
</div>
</section>
<section id="back-calculate-emission-on-raod-emission-rate." class="level3">
<h3 class="anchored" data-anchor-id="back-calculate-emission-on-raod-emission-rate.">Back-calculate Emission On-raod Emission Rate.</h3>
<div class="cell" data-execution_count="6">
<pre class="python3 cell-code"><code>suft_emis.process_lab.unique()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>array(['Running_Exh', 'Start_Exh', 'Crank_Run_Exh', 'Crank_Start_Exh',
       'Crank_Ext_Idle', 'Ext_Idle_Exh', 'Aux_Power_Exh',
       'Evap_Permeation', 'Evap_Fuel_Vent', 'Evap_Fuel_Leak', 'Brakewear',
       'Tirewear'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="7">
<pre class="python3 cell-code"><code># Note that 'pollutant_id' and 'short_name_mvs3' are different from 'eis_poll_nei17' and 'short_name_nei17'. 'short_name_mvs3' for instance has PM10 exhaust, brakewear, and tirewear. While NEI combines the three. I am removing MOVES pollutant for this analysis.
suft_emis_1 = (
    suft_emis.loc[
        (
            suft_emis.process_lab.isin(
                [
                    "Running_Exh",
                    "Crank_Run_Exh",
                    "Brakewear",
                    "Tirewear",
                    "Evap_Permeation",
                    "Evap_Fuel_Vent",
                    "Evap_Fuel_Leak",
                ]
            )
        )
        &amp; (suft_emis.road_type_id != 1)
    ]
    .groupby(
        [
            "county",
            "fips",
            "year_id",
            "road_type_id",
            "roadtype_lab",
            "eis_poll_nei17",
            "short_name_nei17",
            "source_type_id",
            "fuel_type_id",
        ],
        as_index=False,
    )
    .emission_quant.sum()
)
</code></pre>
</div>
<div class="cell" data-execution_count="8">
<pre class="python3 cell-code"><code>suft_emis.loc[
    lambda df: df.eis_poll_nei17 == "PM10-PRI", ["eis_poll_nei17", "short_name_mvs3"]
].drop_duplicates()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="8">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">short_name_mvs3</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">3168</td>
<td>PM10-PRI</td>
<td>PM10 Total Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6434</td>
<td>PM10-PRI</td>
<td>PM10 Brakewear</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6456</td>
<td>PM10-PRI</td>
<td>PM10 Tirewear</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="9">
<pre class="python3 cell-code"><code>suft_emis.loc[
    lambda df: (
        df.eis_poll_nei17.isin(
            ["CO", "SO2", "NOX", "VOC", "CO2", "PM10-PRI", "PM25-PRI", 71432]
        )
    )
    &amp; (df.road_type_id == 1),
    ["eis_poll_nei17", "process_lab"],
].drop_duplicates().sort_values(["eis_poll_nei17", "process_lab"])
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="9">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">process_lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">90</td>
<td>CO</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">88</td>
<td>CO</td>
<td>Crank_Ext_Idle</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">44</td>
<td>CO</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">66</td>
<td>CO</td>
<td>Crank_Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">89</td>
<td>CO</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">0</td>
<td>CO</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">22</td>
<td>CO</td>
<td>Start_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3167</td>
<td>CO2</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3166</td>
<td>CO2</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3122</td>
<td>CO2</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3144</td>
<td>CO2</td>
<td>Start_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">181</td>
<td>NOX</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">179</td>
<td>NOX</td>
<td>Crank_Ext_Idle</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">135</td>
<td>NOX</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">157</td>
<td>NOX</td>
<td>Crank_Start_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">180</td>
<td>NOX</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">91</td>
<td>NOX</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">113</td>
<td>NOX</td>
<td>Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3258</td>
<td>PM10-PRI</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3256</td>
<td>PM10-PRI</td>
<td>Crank_Ext_Idle</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3212</td>
<td>PM10-PRI</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3234</td>
<td>PM10-PRI</td>
<td>Crank_Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3257</td>
<td>PM10-PRI</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3168</td>
<td>PM10-PRI</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3190</td>
<td>PM10-PRI</td>
<td>Start_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3349</td>
<td>PM25-PRI</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3347</td>
<td>PM25-PRI</td>
<td>Crank_Ext_Idle</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3303</td>
<td>PM25-PRI</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3325</td>
<td>PM25-PRI</td>
<td>Crank_Start_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3348</td>
<td>PM25-PRI</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3259</td>
<td>PM25-PRI</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3281</td>
<td>PM25-PRI</td>
<td>Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">848</td>
<td>SO2</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">847</td>
<td>SO2</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">803</td>
<td>SO2</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">825</td>
<td>SO2</td>
<td>Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3121</td>
<td>VOC</td>
<td>Aux_Power_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3119</td>
<td>VOC</td>
<td>Crank_Ext_Idle</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3075</td>
<td>VOC</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3097</td>
<td>VOC</td>
<td>Crank_Start_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3065</td>
<td>VOC</td>
<td>Evap_Fuel_Leak</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3055</td>
<td>VOC</td>
<td>Evap_Fuel_Vent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3045</td>
<td>VOC</td>
<td>Evap_Permeation</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3120</td>
<td>VOC</td>
<td>Ext_Idle_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">3001</td>
<td>VOC</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3023</td>
<td>VOC</td>
<td>Start_Exh</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="10">
<pre class="python3 cell-code"><code>suft_emis.loc[
    lambda df: (
        df.eis_poll_nei17.isin(
            ["CO", "SO2", "NOX", "VOC", "CO2", "PM10-PRI", "PM25-PRI", 71432]
        )
    )
    &amp; (df.road_type_id != 1),
    ["eis_poll_nei17", "process_lab"],
].drop_duplicates().sort_values(["eis_poll_nei17", "process_lab"])
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="10">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">process_lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">4828</td>
<td>CO</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4806</td>
<td>CO</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6368</td>
<td>CO2</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">4872</td>
<td>NOX</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4850</td>
<td>NOX</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6434</td>
<td>PM10-PRI</td>
<td>Brakewear</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6412</td>
<td>PM10-PRI</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6390</td>
<td>PM10-PRI</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6456</td>
<td>PM10-PRI</td>
<td>Tirewear</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6522</td>
<td>PM25-PRI</td>
<td>Brakewear</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6500</td>
<td>PM25-PRI</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6478</td>
<td>PM25-PRI</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6544</td>
<td>PM25-PRI</td>
<td>Tirewear</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5180</td>
<td>SO2</td>
<td>Running_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6346</td>
<td>VOC</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9384</td>
<td>VOC</td>
<td>Evap_Fuel_Leak</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9374</td>
<td>VOC</td>
<td>Evap_Fuel_Vent</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9364</td>
<td>VOC</td>
<td>Evap_Permeation</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6324</td>
<td>VOC</td>
<td>Running_Exh</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="11">
<pre class="python3 cell-code"><code>suft_emis.loc[
    lambda df: (df.eis_poll_nei17 == "VOC") &amp; (df.road_type_id != 1),
    ["eis_poll_nei17", "process_lab"],
].drop_duplicates()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="11">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">process_lab</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">6324</td>
<td>VOC</td>
<td>Running_Exh</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">6346</td>
<td>VOC</td>
<td>Crank_Run_Exh</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9364</td>
<td>VOC</td>
<td>Evap_Permeation</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">9374</td>
<td>VOC</td>
<td>Evap_Fuel_Vent</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">9384</td>
<td>VOC</td>
<td>Evap_Fuel_Leak</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="12">
<pre class="python3 cell-code"><code>suft_emis_vmt = suft_emis_1.merge(
    sutft_vmt,
    on=[
        "county",
        "fips",
        "year_id",
        "road_type_id",
        "roadtype_lab",
        "source_type_id",
        "fuel_type_id",
    ],
    how="left",
)
</code></pre>
</div>
<div class="cell" data-execution_count="13">
<pre class="python3 cell-code"><code>suft_emis_vmt_onroad = suft_emis_vmt.loc[
    lambda df: (df.road_type_id != 1) &amp; (df.vmt != 0)
]
suft_emis_vmt_onroad["emission_rate_calc"] = (
    suft_emis_vmt_onroad.emission_quant / suft_emis_vmt_onroad.vmt
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\1773013509.py:4: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  suft_emis_vmt_onroad["emission_rate_calc"] = (</code></pre>
</div>
</div>
<p>Filter to Analysis FIPS and get Dennis’s VMT-Mix from the Data</p>
<div class="cell" data-execution_count="14">
<pre class="python3 cell-code"><code>suft_emis_vmt_onroad_anly = suft_emis_vmt_onroad.loc[
    lambda df: df.fips.isin(analysis_fips)
]
suft_emis_vmt_onroad_anly["vmt_mix_dp"] = (
    suft_emis_vmt_onroad_anly.vmt / suft_emis_vmt_onroad_anly.vmt_agg
)
</code></pre>
</div>
</section>
</section>
<section id="load-fy22-and-f23-vmt-mix-created-by-axb" class="level2">
<h2 class="anchored" data-anchor-id="load-fy22-and-f23-vmt-mix-created-by-axb">Load FY22 and F23 VMT-Mix Created by AxB</h2>
<div class="cell" data-execution_count="15">
<pre class="python3 cell-code"><code>vmtmix_fy22_13_19 = pd.read_csv(path_vmtmix_fy22_13_19)
vmtmix_fy23_13_21 = pd.read_csv(path_vmtmix_fy23_13_21)
</code></pre>
</div>
<p>Process FY22 2013 – 2019 VMT-Mix and add suffix.</p>
<div class="cell" data-execution_count="16">
<pre class="python3 cell-code"><code>vmtmix_fy22_13_19 = vmtmix_fy22_13_19.merge(district_map_anly, on="txdot_dist")
assert (
    set(vmtmix_fy22_13_19.fips.unique()).symmetric_difference(set(analysis_fips))
    == set()
)
vmtmix_fy22_13_19_filt = vmtmix_fy22_13_19.loc[
    lambda df: (df.dowagg == "Wkd")
    &amp; (df.tod == "day")
    &amp; (df.mvs_rdtype_nm != "ALL")
    &amp; (df.yearID == 2020)
]
assert len(analysis_fips) * 24 * 4 == len(vmtmix_fy22_13_19_filt)
vmtmix_fy22_13_19_filt["road_type_id"] = vmtmix_fy22_13_19_filt.mvs_rdtype.astype(int)
vmtmix_fy22_13_19_filt = vmtmix_fy22_13_19_filt.filter(
    items=["fips", "district", "road_type_id", "sourceTypeID", "fuelTypeID", "vmt_mix"]
).rename(
    columns={
        "sourceTypeID": "source_type_id",
        "fuelTypeID": "fuel_type_id",
        "vmt_mix": "vmt_mix_fy22_13_19",
    }
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\4134271923.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  vmtmix_fy22_13_19_filt["road_type_id"] = vmtmix_fy22_13_19_filt.mvs_rdtype.astype(int)</code></pre>
</div>
</div>
<p>Process FY23 2013 – 2021 VMT-Mix and add suffix.</p>
<div class="cell" data-execution_count="17">
<pre class="python3 cell-code"><code>vmtmix_fy23_13_21 = vmtmix_fy23_13_21.merge(district_map_anly, on="txdot_dist")
assert (
    set(vmtmix_fy23_13_21.fips.unique()).symmetric_difference(set(analysis_fips))
    == set()
)
vmtmix_fy23_13_21_filt = vmtmix_fy23_13_21.loc[
    lambda df: (df.dowagg == "Wkd")
    &amp; (df.tod == "day")
    &amp; (df.mvs_rdtype_nm != "ALL")
    &amp; (df.yearID == 2020)
]
assert len(analysis_fips) * 24 * 4 == len(vmtmix_fy23_13_21_filt)
vmtmix_fy23_13_21_filt["road_type_id"] = vmtmix_fy23_13_21_filt.mvs_rdtype.astype(int)
vmtmix_fy23_13_21_filt = vmtmix_fy23_13_21_filt.filter(
    items=["fips", "district", "road_type_id", "sourceTypeID", "fuelTypeID", "vmt_mix"]
).rename(
    columns={
        "sourceTypeID": "source_type_id",
        "fuelTypeID": "fuel_type_id",
        "vmt_mix": "vmt_mix_fy23_13_21",
    }
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\3699093946.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  vmtmix_fy23_13_21_filt["road_type_id"] = vmtmix_fy23_13_21_filt.mvs_rdtype.astype(int)</code></pre>
</div>
</div>
</section>
<section id="merge-aerr-2020-processed-data-with-new-vmt-mixes" class="level2">
<h2 class="anchored" data-anchor-id="merge-aerr-2020-processed-data-with-new-vmt-mixes">Merge AERR 2020 Processed Data with New VMT-Mixes</h2>
<div class="cell" data-execution_count="18">
<pre class="python3 cell-code"><code>suft_emis_vmt_onroad_anly.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="18">
<pre><code>Index(['county', 'fips', 'year_id', 'road_type_id', 'roadtype_lab',
       'eis_poll_nei17', 'short_name_nei17', 'source_type_id', 'fuel_type_id',
       'emission_quant', 'activity_type_id', 'mvs_act_type',
       'sut_fueltype_lab', 'act_em_lab', 'vmt', 'vmt_agg',
       'emission_rate_calc', 'vmt_mix_dp'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-tags="[&quot;Merge AERR with VMT-Mix&quot;]" data-execution_count="19">
<pre class="python3 cell-code"><code>suft_emis_vmt_onroad_anly_1 = suft_emis_vmt_onroad_anly.merge(
    vmtmix_fy22_13_19_filt,
    on=["fips", "road_type_id", "source_type_id", "fuel_type_id"],
).merge(
    vmtmix_fy23_13_21_filt,
    on=["district", "fips", "road_type_id", "source_type_id", "fuel_type_id"],
)
suft_emis_vmt_onroad_anly_1["rdtype_sutft"] = (
    suft_emis_vmt_onroad_anly_1.road_type_id.astype(str)
    + "_"
    + suft_emis_vmt_onroad_anly_1.source_type_id.astype(str)
    + "_"
    + suft_emis_vmt_onroad_anly_1.fuel_type_id.astype(str)
)

suft_emis_vmt_onroad_anly_1[
    "vmt_mix_fy22_13_19"
] = suft_emis_vmt_onroad_anly_1.vmt_mix_fy22_13_19 / suft_emis_vmt_onroad_anly_1.groupby(
    [
        "district",
        "county",
        "fips",
        "year_id",
        "road_type_id",
        "roadtype_lab",
        "eis_poll_nei17",
        "short_name_nei17",
        "act_em_lab",
    ]
).vmt_mix_fy22_13_19.transform(
    sum
)

suft_emis_vmt_onroad_anly_1[
    "vmt_mix_fy23_13_21"
] = suft_emis_vmt_onroad_anly_1.vmt_mix_fy23_13_21 / suft_emis_vmt_onroad_anly_1.groupby(
    [
        "district",
        "county",
        "fips",
        "year_id",
        "road_type_id",
        "roadtype_lab",
        "eis_poll_nei17",
        "short_name_nei17",
        "act_em_lab",
    ]
).vmt_mix_fy23_13_21.transform(
    sum
)

suft_emis_vmt_onroad_anly_1["vmt_fy22"] = (
    suft_emis_vmt_onroad_anly_1.vmt_agg * suft_emis_vmt_onroad_anly_1.vmt_mix_fy22_13_19
)

suft_emis_vmt_onroad_anly_1["vmt_fy23"] = (
    suft_emis_vmt_onroad_anly_1.vmt_agg * suft_emis_vmt_onroad_anly_1.vmt_mix_fy23_13_21
)

suft_emis_vmt_onroad_anly_1["emission_quant_fy22"] = (
    suft_emis_vmt_onroad_anly_1.emission_rate_calc
    * suft_emis_vmt_onroad_anly_1.vmt_fy22
    / 365
)
suft_emis_vmt_onroad_anly_1["emission_quant_fy23"] = (
    suft_emis_vmt_onroad_anly_1.emission_rate_calc
    * suft_emis_vmt_onroad_anly_1.vmt_fy23
    / 365
)

suft_emis_vmt_onroad_anly_1["emission_quant_dp"] = (
    suft_emis_vmt_onroad_anly_1.emission_quant / 365
)
</code></pre>
</div>
<div class="cell" data-execution_count="20">
<pre class="python3 cell-code"><code>suft_emis_vmt_onroad_anly_1.loc[
    lambda df: (df.fips == 48113) &amp; (df.short_name_nei17 == "NOx")
].groupby("roadtype_lab").agg(
    vmt=("vmt", sum),
    vmt_agg=("vmt_agg", "mean"),
    vmt_fy22=("vmt_fy22", "sum"),
    vmt_fy23=("vmt_fy23", "sum"),
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="20">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">vmt</th>
<th data-quarto-table-cell-role="th">vmt_agg</th>
<th data-quarto-table-cell-role="th">vmt_fy22</th>
<th data-quarto-table-cell-role="th">vmt_fy23</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">roadtype_lab</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Rural Restricted Access</td>
<td>5.636527e+08</td>
<td>5.636527e+08</td>
<td>5.636527e+08</td>
<td>5.636527e+08</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Rural Unrestricted Access</td>
<td>2.642556e+08</td>
<td>2.642556e+08</td>
<td>2.642556e+08</td>
<td>2.642556e+08</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Urban Restricted Access</td>
<td>1.080949e+10</td>
<td>1.080949e+10</td>
<td>1.080949e+10</td>
<td>1.080949e+10</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Urban Unrestricted Access</td>
<td>1.134163e+10</td>
<td>1.134163e+10</td>
<td>1.134163e+10</td>
<td>1.134163e+10</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="21">
<pre class="python3 cell-code"><code>emis_comp_pol = (
    suft_emis_vmt_onroad_anly_1.loc[
        lambda df: df.eis_poll_nei17.isin(
            ["CO", "SO2", "NOX", "VOC", "CO2", "PM10-PRI", "PM25-PRI", 71432]
        )
    ]
    .groupby(["eis_poll_nei17", "county", "fips", "district"], as_index=False)
    .agg(
        vmt_mix_dp=("vmt_mix_dp", "sum"),
        vmt_mix_fy22=("vmt_mix_fy22_13_19", "sum"),
        vmt_mix_fy23=("vmt_mix_fy23_13_21", "sum"),
        vmt_dp=("vmt", "sum"),
        vmt_fy22=("vmt_fy22", "sum"),
        vmt_fy23=("vmt_fy23", "sum"),
        emission_quant_dp=("emission_quant_dp", "sum"),
        emission_quant_fy22=("emission_quant_fy22", "sum"),
        emission_quant_fy23=("emission_quant_fy23", "sum"),
    )
)
emis_comp_pol_cnty = emis_comp_pol.assign(
    vmt_mix_diff_fy22_dp=lambda df: df.vmt_mix_fy22 - df.vmt_mix_dp,
    vmt_mix_diff_fy23_dp=lambda df: df.vmt_mix_fy23 - df.vmt_mix_dp,
    vmt_mix_diff_fy23_fy22=lambda df: df.vmt_mix_fy23 - df.vmt_mix_fy22,
    vmt_diff_fy22_dp=lambda df: df.vmt_fy22 - df.vmt_dp,
    vmt_diff_fy23_dp=lambda df: df.vmt_fy23 - df.vmt_dp,
    vmt_diff_fy23_fy22=lambda df: df.vmt_fy23 - df.vmt_fy22,
    vmt_perdiff_fy22_dp=lambda df: 100 * df.vmt_diff_fy22_dp / df.vmt_dp,
    vmt_perdiff_fy23_dp=lambda df: 100 * df.vmt_diff_fy23_dp / df.vmt_dp,
    vmt_perdiff_fy23_fy22=lambda df: 100 * df.vmt_diff_fy23_fy22 / df.vmt_fy22,
    emission_quant_diff_fy22_dp=lambda df: df.emission_quant_fy22
    - df.emission_quant_dp,
    emission_quant_diff_fy23_dp=lambda df: df.emission_quant_fy23
    - df.emission_quant_dp,
    emission_quant_diff_fy23_fy22=lambda df: df.emission_quant_fy23
    - df.emission_quant_fy22,
    emission_quant_perdiff_fy22_dp=lambda df: 100
    * df.emission_quant_diff_fy22_dp
    / df.emission_quant_dp,
    emission_quant_perdiff_fy23_dp=lambda df: 100
    * df.emission_quant_diff_fy23_dp
    / df.emission_quant_dp,
    emission_quant_perdiff_fy23_fy22=lambda df: 100
    * df.emission_quant_diff_fy23_fy22
    / df.emission_quant_fy22,
)
</code></pre>
</div>
<p>Output file</p>
<div class="cell" data-execution_count="22">
<pre class="python3 cell-code"><code>path_out = Path.joinpath(path_vmtmix_fy22_13_19.parent, "QC", "aerr_vmt_mix_impact.csv")
emis_comp_pol_cnty.to_csv(path_out)
</code></pre>
</div>
<div class="cell" data-execution_count="23">
<pre class="python3 cell-code"><code>pd.options.display.float_format = "{:,.5f}".format
</code></pre>
</div>
<div class="cell" data-execution_count="24">
<pre class="python3 cell-code"><code>emis_comp_pol_nox = emis_comp_pol_cnty.loc[
    lambda df: (df.eis_poll_nei17.isin(["NOX"]) &amp; (df.fips == 48353))
][
    [
        "vmt_mix_dp",
        "vmt_mix_fy22",
        "vmt_mix_fy23",
        "vmt_dp",
        "vmt_fy22",
        "vmt_fy23",
        "emission_quant_dp",
        "emission_quant_fy22",
        "emission_quant_fy23",
    ]
].sum()
emis_comp_pol_nox
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="24">
<pre><code>vmt_mix_dp                      4.00000
vmt_mix_fy22                    4.00000
vmt_mix_fy23                    4.00000
vmt_dp                414,585,308.95400
vmt_fy22              414,585,308.95400
vmt_fy23              414,585,308.95400
emission_quant_dp               1.60332
emission_quant_fy22             1.73555
emission_quant_fy23             1.71002
dtype: float64</code></pre>
</div>
</div>
<section id="get-contribution-of-different-sut-ft-for-overall-emissions" class="level3">
<h3 class="anchored" data-anchor-id="get-contribution-of-different-sut-ft-for-overall-emissions">Get contribution of different SUT-FT for overall emissions</h3>
<div class="cell" data-execution_count="25">
<pre class="python3 cell-code"><code>filt_emis_cmb = suft_emis_vmt_onroad_anly_1.loc[
    lambda df: df.eis_poll_nei17.isin(
        ["CO", "SO2", "NOX", "VOC", "CO2", "PM10-PRI", "PM25-PRI", 71432]
    )
]
filt_emis_cmb["emission_quant_diff_fy23_dp"] = (
    filt_emis_cmb.emission_quant_fy23 - filt_emis_cmb.emission_quant_dp
)
filt_emis_cmb["emission_quant_diff_fy23_fy22"] = (
    filt_emis_cmb.emission_quant_fy23 - filt_emis_cmb.emission_quant_fy22
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\741351983.py:6: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  filt_emis_cmb["emission_quant_diff_fy23_dp"] = (
C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\741351983.py:9: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  filt_emis_cmb["emission_quant_diff_fy23_fy22"] = (</code></pre>
</div>
</div>
<div class="cell" data-execution_count="26">
<pre class="python3 cell-code"><code>filt_emis_cmb.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="26">
<pre><code>Index(['county', 'fips', 'year_id', 'road_type_id', 'roadtype_lab',
       'eis_poll_nei17', 'short_name_nei17', 'source_type_id', 'fuel_type_id',
       'emission_quant', 'activity_type_id', 'mvs_act_type',
       'sut_fueltype_lab', 'act_em_lab', 'vmt', 'vmt_agg',
       'emission_rate_calc', 'vmt_mix_dp', 'district', 'vmt_mix_fy22_13_19',
       'vmt_mix_fy23_13_21', 'rdtype_sutft', 'vmt_fy22', 'vmt_fy23',
       'emission_quant_fy22', 'emission_quant_fy23', 'emission_quant_dp',
       'emission_quant_diff_fy23_dp', 'emission_quant_diff_fy23_fy22'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="27">
<pre class="python3 cell-code"><code>rdtype_sutft_contr_fy23_dp = pd.pivot_table(
    filt_emis_cmb,
    index=["eis_poll_nei17", "county", "fips", "district"],
    columns=["rdtype_sutft"],
    values="emission_quant_diff_fy23_dp",
    fill_value=0,
    margins=True,
    aggfunc=sum,
).reset_index()
rdtype_sutft_contr_fy23_dp1 = rdtype_sutft_contr_fy23_dp.loc[
    rdtype_sutft_contr_fy23_dp.eis_poll_nei17 != "All"
]
rdtype_sutft_contr_fy23_dp1[
    [
        "2_11_1",
        "2_21_1",
        "2_21_2",
        "2_31_1",
        "2_31_2",
        "2_32_1",
        "2_32_2",
        "2_41_2",
        "2_42_2",
        "2_43_1",
        "2_43_2",
        "2_51_1",
        "2_51_2",
        "2_52_1",
        "2_52_2",
        "2_53_1",
        "2_53_2",
        "2_54_1",
        "2_54_2",
        "2_61_1",
        "2_61_2",
        "2_62_2",
        "3_11_1",
        "3_21_1",
        "3_21_2",
        "3_31_1",
        "3_31_2",
        "3_32_1",
        "3_32_2",
        "3_41_2",
        "3_42_2",
        "3_43_1",
        "3_43_2",
        "3_51_1",
        "3_51_2",
        "3_52_1",
        "3_52_2",
        "3_53_1",
        "3_53_2",
        "3_54_1",
        "3_54_2",
        "3_61_1",
        "3_61_2",
        "3_62_2",
        "4_11_1",
        "4_21_1",
        "4_21_2",
        "4_31_1",
        "4_31_2",
        "4_32_1",
        "4_32_2",
        "4_41_2",
        "4_42_2",
        "4_43_1",
        "4_43_2",
        "4_51_1",
        "4_51_2",
        "4_52_1",
        "4_52_2",
        "4_53_1",
        "4_53_2",
        "4_54_1",
        "4_54_2",
        "4_61_1",
        "4_61_2",
        "4_62_2",
        "5_11_1",
        "5_21_1",
        "5_21_2",
        "5_31_1",
        "5_31_2",
        "5_32_1",
        "5_32_2",
        "5_41_2",
        "5_42_2",
        "5_43_1",
        "5_43_2",
        "5_51_1",
        "5_51_2",
        "5_52_1",
        "5_52_2",
        "5_53_1",
        "5_53_2",
        "5_54_1",
        "5_54_2",
        "5_61_1",
        "5_61_2",
        "5_62_2",
    ]
] = 100 * rdtype_sutft_contr_fy23_dp1[
    [
        "2_11_1",
        "2_21_1",
        "2_21_2",
        "2_31_1",
        "2_31_2",
        "2_32_1",
        "2_32_2",
        "2_41_2",
        "2_42_2",
        "2_43_1",
        "2_43_2",
        "2_51_1",
        "2_51_2",
        "2_52_1",
        "2_52_2",
        "2_53_1",
        "2_53_2",
        "2_54_1",
        "2_54_2",
        "2_61_1",
        "2_61_2",
        "2_62_2",
        "3_11_1",
        "3_21_1",
        "3_21_2",
        "3_31_1",
        "3_31_2",
        "3_32_1",
        "3_32_2",
        "3_41_2",
        "3_42_2",
        "3_43_1",
        "3_43_2",
        "3_51_1",
        "3_51_2",
        "3_52_1",
        "3_52_2",
        "3_53_1",
        "3_53_2",
        "3_54_1",
        "3_54_2",
        "3_61_1",
        "3_61_2",
        "3_62_2",
        "4_11_1",
        "4_21_1",
        "4_21_2",
        "4_31_1",
        "4_31_2",
        "4_32_1",
        "4_32_2",
        "4_41_2",
        "4_42_2",
        "4_43_1",
        "4_43_2",
        "4_51_1",
        "4_51_2",
        "4_52_1",
        "4_52_2",
        "4_53_1",
        "4_53_2",
        "4_54_1",
        "4_54_2",
        "4_61_1",
        "4_61_2",
        "4_62_2",
        "5_11_1",
        "5_21_1",
        "5_21_2",
        "5_31_1",
        "5_31_2",
        "5_32_1",
        "5_32_2",
        "5_41_2",
        "5_42_2",
        "5_43_1",
        "5_43_2",
        "5_51_1",
        "5_51_2",
        "5_52_1",
        "5_52_2",
        "5_53_1",
        "5_53_2",
        "5_54_1",
        "5_54_2",
        "5_61_1",
        "5_61_2",
        "5_62_2",
    ]
].div(
    rdtype_sutft_contr_fy23_dp1.All, axis=0
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\974488314.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  rdtype_sutft_contr_fy23_dp1[</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<pre class="python3 cell-code"><code>np.allclose(
    rdtype_sutft_contr_fy23_dp1[
        [
            "2_11_1",
            "2_21_1",
            "2_21_2",
            "2_31_1",
            "2_31_2",
            "2_32_1",
            "2_32_2",
            "2_41_2",
            "2_42_2",
            "2_43_1",
            "2_43_2",
            "2_51_1",
            "2_51_2",
            "2_52_1",
            "2_52_2",
            "2_53_1",
            "2_53_2",
            "2_54_1",
            "2_54_2",
            "2_61_1",
            "2_61_2",
            "2_62_2",
            "3_11_1",
            "3_21_1",
            "3_21_2",
            "3_31_1",
            "3_31_2",
            "3_32_1",
            "3_32_2",
            "3_41_2",
            "3_42_2",
            "3_43_1",
            "3_43_2",
            "3_51_1",
            "3_51_2",
            "3_52_1",
            "3_52_2",
            "3_53_1",
            "3_53_2",
            "3_54_1",
            "3_54_2",
            "3_61_1",
            "3_61_2",
            "3_62_2",
            "4_11_1",
            "4_21_1",
            "4_21_2",
            "4_31_1",
            "4_31_2",
            "4_32_1",
            "4_32_2",
            "4_41_2",
            "4_42_2",
            "4_43_1",
            "4_43_2",
            "4_51_1",
            "4_51_2",
            "4_52_1",
            "4_52_2",
            "4_53_1",
            "4_53_2",
            "4_54_1",
            "4_54_2",
            "4_61_1",
            "4_61_2",
            "4_62_2",
            "5_11_1",
            "5_21_1",
            "5_21_2",
            "5_31_1",
            "5_31_2",
            "5_32_1",
            "5_32_2",
            "5_41_2",
            "5_42_2",
            "5_43_1",
            "5_43_2",
            "5_51_1",
            "5_51_2",
            "5_52_1",
            "5_52_2",
            "5_53_1",
            "5_53_2",
            "5_54_1",
            "5_54_2",
            "5_61_1",
            "5_61_2",
            "5_62_2",
        ]
    ].sum(axis=1),
    100,
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<pre class="python3 cell-code"><code>rdtype_sutft_contr_fy23_fy22 = pd.pivot_table(
    filt_emis_cmb,
    index=["eis_poll_nei17", "county", "fips", "district"],
    columns=["rdtype_sutft"],
    values="emission_quant_diff_fy23_fy22",
    fill_value=0,
    margins=True,
    aggfunc=sum,
).reset_index()
rdtype_sutft_contr_fy23_fy22_1 = rdtype_sutft_contr_fy23_fy22.loc[
    rdtype_sutft_contr_fy23_fy22.eis_poll_nei17 != "All"
]
rdtype_sutft_contr_fy23_fy22_1[
    [
        "2_11_1",
        "2_21_1",
        "2_21_2",
        "2_31_1",
        "2_31_2",
        "2_32_1",
        "2_32_2",
        "2_41_2",
        "2_42_2",
        "2_43_1",
        "2_43_2",
        "2_51_1",
        "2_51_2",
        "2_52_1",
        "2_52_2",
        "2_53_1",
        "2_53_2",
        "2_54_1",
        "2_54_2",
        "2_61_1",
        "2_61_2",
        "2_62_2",
        "3_11_1",
        "3_21_1",
        "3_21_2",
        "3_31_1",
        "3_31_2",
        "3_32_1",
        "3_32_2",
        "3_41_2",
        "3_42_2",
        "3_43_1",
        "3_43_2",
        "3_51_1",
        "3_51_2",
        "3_52_1",
        "3_52_2",
        "3_53_1",
        "3_53_2",
        "3_54_1",
        "3_54_2",
        "3_61_1",
        "3_61_2",
        "3_62_2",
        "4_11_1",
        "4_21_1",
        "4_21_2",
        "4_31_1",
        "4_31_2",
        "4_32_1",
        "4_32_2",
        "4_41_2",
        "4_42_2",
        "4_43_1",
        "4_43_2",
        "4_51_1",
        "4_51_2",
        "4_52_1",
        "4_52_2",
        "4_53_1",
        "4_53_2",
        "4_54_1",
        "4_54_2",
        "4_61_1",
        "4_61_2",
        "4_62_2",
        "5_11_1",
        "5_21_1",
        "5_21_2",
        "5_31_1",
        "5_31_2",
        "5_32_1",
        "5_32_2",
        "5_41_2",
        "5_42_2",
        "5_43_1",
        "5_43_2",
        "5_51_1",
        "5_51_2",
        "5_52_1",
        "5_52_2",
        "5_53_1",
        "5_53_2",
        "5_54_1",
        "5_54_2",
        "5_61_1",
        "5_61_2",
        "5_62_2",
    ]
] = 100 * rdtype_sutft_contr_fy23_fy22_1[
    [
        "2_11_1",
        "2_21_1",
        "2_21_2",
        "2_31_1",
        "2_31_2",
        "2_32_1",
        "2_32_2",
        "2_41_2",
        "2_42_2",
        "2_43_1",
        "2_43_2",
        "2_51_1",
        "2_51_2",
        "2_52_1",
        "2_52_2",
        "2_53_1",
        "2_53_2",
        "2_54_1",
        "2_54_2",
        "2_61_1",
        "2_61_2",
        "2_62_2",
        "3_11_1",
        "3_21_1",
        "3_21_2",
        "3_31_1",
        "3_31_2",
        "3_32_1",
        "3_32_2",
        "3_41_2",
        "3_42_2",
        "3_43_1",
        "3_43_2",
        "3_51_1",
        "3_51_2",
        "3_52_1",
        "3_52_2",
        "3_53_1",
        "3_53_2",
        "3_54_1",
        "3_54_2",
        "3_61_1",
        "3_61_2",
        "3_62_2",
        "4_11_1",
        "4_21_1",
        "4_21_2",
        "4_31_1",
        "4_31_2",
        "4_32_1",
        "4_32_2",
        "4_41_2",
        "4_42_2",
        "4_43_1",
        "4_43_2",
        "4_51_1",
        "4_51_2",
        "4_52_1",
        "4_52_2",
        "4_53_1",
        "4_53_2",
        "4_54_1",
        "4_54_2",
        "4_61_1",
        "4_61_2",
        "4_62_2",
        "5_11_1",
        "5_21_1",
        "5_21_2",
        "5_31_1",
        "5_31_2",
        "5_32_1",
        "5_32_2",
        "5_41_2",
        "5_42_2",
        "5_43_1",
        "5_43_2",
        "5_51_1",
        "5_51_2",
        "5_52_1",
        "5_52_2",
        "5_53_1",
        "5_53_2",
        "5_54_1",
        "5_54_2",
        "5_61_1",
        "5_61_2",
        "5_62_2",
    ]
].div(
    rdtype_sutft_contr_fy23_fy22_1.All, axis=0
)
</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>C:\Users\a-bibeka\AppData\Local\Temp\ipykernel_34020\1495726720.py:13: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  rdtype_sutft_contr_fy23_fy22_1[</code></pre>
</div>
</div>
<div class="cell" data-execution_count="30">
<pre class="python3 cell-code"><code>np.allclose(
    rdtype_sutft_contr_fy23_fy22_1[
        [
            "2_11_1",
            "2_21_1",
            "2_21_2",
            "2_31_1",
            "2_31_2",
            "2_32_1",
            "2_32_2",
            "2_41_2",
            "2_42_2",
            "2_43_1",
            "2_43_2",
            "2_51_1",
            "2_51_2",
            "2_52_2",
            "2_53_1",
            "2_53_2",
            "2_54_1",
            "2_54_2",
            "2_61_1",
            "2_61_2",
            "2_62_2",
            "3_11_1",
            "3_21_1",
            "3_21_2",
            "3_31_1",
            "3_31_2",
            "3_32_1",
            "3_32_2",
            "3_41_2",
            "3_42_2",
            "3_43_1",
            "3_43_2",
            "3_51_1",
            "3_51_2",
            "3_52_1",
            "3_52_2",
            "3_53_1",
            "3_53_2",
            "3_54_1",
            "3_54_2",
            "3_61_1",
            "3_61_2",
            "3_62_2",
            "4_11_1",
            "4_21_1",
            "4_21_2",
            "4_31_1",
            "4_31_2",
            "4_32_1",
            "4_32_2",
            "4_41_2",
            "4_42_2",
            "4_43_1",
            "4_43_2",
            "4_51_1",
            "4_51_2",
            "4_52_1",
            "4_52_2",
            "4_53_1",
            "4_53_2",
            "4_54_1",
            "4_54_2",
            "4_61_1",
            "4_61_2",
            "4_62_2",
            "5_11_1",
            "5_21_1",
            "5_21_2",
            "5_31_1",
            "5_31_2",
            "5_32_1",
            "5_32_2",
            "5_41_2",
            "5_42_2",
            "5_43_1",
            "5_43_2",
            "5_51_1",
            "5_51_2",
            "5_52_1",
            "5_52_2",
            "5_53_1",
            "5_53_2",
            "5_54_1",
            "5_54_2",
            "5_61_1",
            "5_61_2",
            "5_62_2",
        ]
    ].sum(axis=1),
    100,
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="30">
<pre><code>False</code></pre>
</div>
</div>
<div class="cell" data-execution_count="31">
<pre class="python3 cell-code"><code>path_out = Path.joinpath(
    path_vmtmix_fy22_13_19.parent, "QC", "rdtype_sutft_contr_fy23_dp.csv"
)
rdtype_sutft_contr_fy23_dp1.to_csv(path_out)
</code></pre>
</div>
<div class="cell" data-execution_count="32">
<pre class="python3 cell-code"><code>path_out = Path.joinpath(
    path_vmtmix_fy22_13_19.parent, "QC", "rdtype_sutft_contr_fy23_fy22.csv"
)
rdtype_sutft_contr_fy23_fy22_1.to_csv(path_out)
</code></pre>
</div>
</section>
</section>
<section id="tables-and-figures-emission-and-vmt" class="level2">
<h2 class="anchored" data-anchor-id="tables-and-figures-emission-and-vmt">Tables and Figures Emission and VMT</h2>
<section id="statewide-impact" class="level3">
<h3 class="anchored" data-anchor-id="statewide-impact">Statewide impact</h3>
<div class="cell" data-execution_count="33">
<pre class="python3 cell-code"><code>emis_comp_pol_cnty.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>Index(['eis_poll_nei17', 'county', 'fips', 'district', 'vmt_mix_dp',
       'vmt_mix_fy22', 'vmt_mix_fy23', 'vmt_dp', 'vmt_fy22', 'vmt_fy23',
       'emission_quant_dp', 'emission_quant_fy22', 'emission_quant_fy23',
       'vmt_mix_diff_fy22_dp', 'vmt_mix_diff_fy23_dp',
       'vmt_mix_diff_fy23_fy22', 'vmt_diff_fy22_dp', 'vmt_diff_fy23_dp',
       'vmt_diff_fy23_fy22', 'vmt_perdiff_fy22_dp', 'vmt_perdiff_fy23_dp',
       'vmt_perdiff_fy23_fy22', 'emission_quant_diff_fy22_dp',
       'emission_quant_diff_fy23_dp', 'emission_quant_diff_fy23_fy22',
       'emission_quant_perdiff_fy22_dp', 'emission_quant_perdiff_fy23_dp',
       'emission_quant_perdiff_fy23_fy22'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<pre class="python3 cell-code"><code>st_emis = (
    emis_comp_pol_cnty.groupby("eis_poll_nei17")
    .agg(
        emission_quant_diff_fy23_fy22=("emission_quant_diff_fy23_fy22", sum),
        emission_quant_fy22=("emission_quant_fy22", sum),
        emission_quant_fy23=("emission_quant_fy23", sum),
    )
    .reset_index()
    .assign(
        emission_quant_perdiff_fy23_fy22=lambda df: 100
        * df.emission_quant_diff_fy23_fy22
        / df.emission_quant_fy22
    )
    .filter(
        items=[
            "eis_poll_nei17",
            "emission_quant_fy22",
            "emission_quant_fy23",
            "emission_quant_diff_fy23_fy22",
            "emission_quant_perdiff_fy23_fy22",
        ]
    )
    .rename(
        columns={
            "eis_poll_nei17": "Pollutants",
            "emission_quant_fy22": "FY22 Avg Daily Emissions (Tons)",
            "emission_quant_fy23": "FY23 Avg Daily Emissions (Tons)",
            "emission_quant_diff_fy23_fy22": "FY23 - FY22 Emissions (Tons)",
            "emission_quant_perdiff_fy23_fy22": "FY23 vs. FY22 Emissions (%)",
        }
    )
)
st_emis.to_csv(r"C:\Users\a-bibeka\Downloads\st_emis.csv", index=False)
</code></pre>
</div>
<div class="cell" data-execution_count="35">
<pre class="python3 cell-code"><code>%load_ext rpy2.ipython
import pandas as pd
st_emis = pd.read_csv(r"C:\Users\a-bibeka\Downloads\st_emis.csv")</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>c:\Users\a-bibeka\AppData\Local\mambaforge\envs\py39\lib\site-packages\rpy2\robjects\packages.py:367: UserWarning: The symbol 'quartz' is not in this R namespace/package.
  warnings.warn(</code></pre>
</div>
</div>
<div class="cell" data-execution_count="36">
<pre class="python3 cell-code"><code>st_emis
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="36">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pollutants</th>
<th data-quarto-table-cell-role="th">FY22 Avg Daily Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 Avg Daily Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 - FY22 Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 vs. FY22 Emissions (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CO</td>
<td>2,155.42281</td>
<td>2,168.67557</td>
<td>13.25276</td>
<td>0.61486</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CO2</td>
<td>373,490.99846</td>
<td>373,395.92225</td>
<td>-95.07621</td>
<td>-0.02546</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NOX</td>
<td>435.55843</td>
<td>432.33853</td>
<td>-3.21990</td>
<td>-0.73926</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>PM10-PRI</td>
<td>41.01429</td>
<td>40.88372</td>
<td>-0.13057</td>
<td>-0.31836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>PM25-PRI</td>
<td>13.69790</td>
<td>13.60418</td>
<td>-0.09372</td>
<td>-0.68418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>SO2</td>
<td>1.90082</td>
<td>1.90440</td>
<td>0.00357</td>
<td>0.18792</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>VOC</td>
<td>50.77773</td>
<td>51.06653</td>
<td>0.28881</td>
<td>0.56877</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="37">
<pre class="python3 cell-code"><code>st_emis["FY22 Avg Daily Emissions (Tons)"] * 365
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="37">
<pre><code>0       786,729.32695
1   136,324,214.43747
2       158,978.82821
3        14,970.21620
4         4,999.73176
5           693.80067
6        18,533.86968
Name: FY22 Avg Daily Emissions (Tons), dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="38">
<pre class="python3 cell-code"><code>st_emis
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="38">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">Pollutants</th>
<th data-quarto-table-cell-role="th">FY22 Avg Daily Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 Avg Daily Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 - FY22 Emissions (Tons)</th>
<th data-quarto-table-cell-role="th">FY23 vs. FY22 Emissions (%)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>CO</td>
<td>2,155.42281</td>
<td>2,168.67557</td>
<td>13.25276</td>
<td>0.61486</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>CO2</td>
<td>373,490.99846</td>
<td>373,395.92225</td>
<td>-95.07621</td>
<td>-0.02546</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NOX</td>
<td>435.55843</td>
<td>432.33853</td>
<td>-3.21990</td>
<td>-0.73926</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>PM10-PRI</td>
<td>41.01429</td>
<td>40.88372</td>
<td>-0.13057</td>
<td>-0.31836</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>PM25-PRI</td>
<td>13.69790</td>
<td>13.60418</td>
<td>-0.09372</td>
<td>-0.68418</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">5</td>
<td>SO2</td>
<td>1.90082</td>
<td>1.90440</td>
<td>0.00357</td>
<td>0.18792</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">6</td>
<td>VOC</td>
<td>50.77773</td>
<td>51.06653</td>
<td>0.28881</td>
<td>0.56877</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-tags="[&quot;state FY23 DP Percent Diff&quot;]" data-execution_count="39">
<pre class="python3 cell-code"><code>%%R -i st_emis -w 600 
require(ggplot2)
require(awtools)
p = ggplot(data=st_emis, aes(x=Pollutants, y=`FY23 vs. FY22 Emissions (%)`, fill=Pollutants)) + geom_col() + 
theme_bw(base_size = 16) + theme(legend.position="none", axis.text.x=element_text(angle=45,hjust=1)) + labs(x = "Pollutants", y = "FY23 vs. FY22 Emissions (%)",) + a_flat_fill()
path_fig_out = "E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/statewide_fy23_fy22_PerDiff.png"
ggsave(path_fig_out)
p</code></pre>
<div class="cell-output cell-output-stderr">
<pre><code>R[write to console]: Loading required package: ggplot2

R[write to console]: Loading required package: awtools
</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Saving 8.33 x 6.67 in image</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="aerr_impact_fy23_files/figure-html/cell-40-output-3.png" class="quarto-discovered-preview-image img-fluid"></p>
</div>
</div>
</section>
<section id="non-attainment-area-impact" class="level3">
<h3 class="anchored" data-anchor-id="non-attainment-area-impact">Non-attainment area impact</h3>
<div class="cell" data-execution_count="40">
<pre class="python3 cell-code"><code>from pathlib import Path

pa_non_att = Path(
    r"E:\Texas A&amp;M Transportation Institute\TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors\Data\fy23_vmt_mix\Input\non_attainment_area.csv"
)
non_att_area = pd.read_csv(pa_non_att)
</code></pre>
</div>
<div class="cell" data-execution_count="41">
<pre class="python3 cell-code"><code>map_cogs = dict(
    zip(
        [
            "East Texas Council of Governments",
            "Alamo Area Council of Governments",
            "Houston-Galveston Area Council",
            "North Central Texas Council of Governments",
            "Rio Grande Council of Governments",
            "Heart of Texas Council of Governments",
            "Permian Basin Regional Planning Commission",
            "Panhandle Regional Planning Commission",
            "Ark-Tex Council of Governments",
        ],
        [
            "ETCOG",
            "AACOG",
            "HGAC",
            "NCTCOG",
            "RIOCOG",
            "HOTCOG",
            "PBRPC",
            "PRPC",
            "ATCOG",
        ],
    )
)
map_pol = {
    "Sulfur Dioxide (2010)": "SO2",
    "8-Hour Ozone (2015) [Moderate]": "NOX",
    "8-Hour Ozone (2008) [Severe 15], 8-Hour Ozone (2015) [Moderate]": "NOX",
    "8-Hour Ozone (2015) [Marginal], PM-10 (1987) [Moderate]": ["NOX", "PM10-PRI"],
    "8-Hour Ozone (2008) [Severe 15]": "NOX",
}
non_att_area["eis_poll_nei17"] = (
    non_att_area["Nonattainment Species"].str.strip().map(map_pol)
)
non_att_area["eis_poll_nei17"] = (
    non_att_area["Nonattainment Species"].str.strip().map(map_pol)
)
non_att_area = non_att_area.explode("eis_poll_nei17")
non_att_area = non_att_area.rename(
    columns={
        "COG_ABRVN": "COG",
        "Name": "county",
        "Dist_NM": "District",
        "Nonattainment Species": "Non-Attainment Status",
    }
)
non_att_area["COG_ABRVN"] = non_att_area["COG"].map(map_cogs)
non_att_area = (
    non_att_area.filter(
        items=[
            "COG_ABRVN",
            "COG",
            "eis_poll_nei17",
            "Non-Attainment Status",
            "District",
            "county",
        ]
    )
    .sort_values(["COG", "eis_poll_nei17", "District", "county"])
    .reset_index(drop=True)
)
</code></pre>
</div>
<div class="cell" data-execution_count="42">
<pre class="python3 cell-code"><code>emis_comp_pol.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="42">
<pre><code>Index(['eis_poll_nei17', 'county', 'fips', 'district', 'vmt_mix_dp',
       'vmt_mix_fy22', 'vmt_mix_fy23', 'vmt_dp', 'vmt_fy22', 'vmt_fy23',
       'emission_quant_dp', 'emission_quant_fy22', 'emission_quant_fy23'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="43">
<pre class="python3 cell-code"><code>non_att_area_emis = non_att_area.merge(emis_comp_pol, on=["county", "eis_poll_nei17"])
</code></pre>
</div>
<div class="cell" data-execution_count="44">
<pre class="python3 cell-code"><code>assert set(non_att_area_emis.county) == set(
    non_att_area.county
), "Some county names did not match between Jon's non-attainment file and my AERR file."
assert all(
    non_att_area_emis.groupby(["COG_ABRVN", "fips"]).fips.nunique() == 1
), "For a COG + Pollutant, some of the counties show up multiple times."
</code></pre>
</div>
<div class="cell" data-execution_count="45">
<pre class="python3 cell-code"><code>non_att_area_emis_1 = non_att_area_emis.assign(
    emission_quant_diff_fy23_fy22=lambda df: df.emission_quant_fy23
    - df.emission_quant_fy22,
    emission_quant_perdiff_fy23_fy22=lambda df: 100
    * df.emission_quant_diff_fy23_fy22
    / df.emission_quant_fy22,
)
</code></pre>
</div>
<div class="cell" data-execution_count="46">
<pre class="python3 cell-code"><code>non_att_area_emis_nox = non_att_area_emis_1.loc[lambda df: df.eis_poll_nei17 == "NOX"]
</code></pre>
</div>
<section id="non-attainment-area-impact-nox" class="level4">
<h4 class="anchored" data-anchor-id="non-attainment-area-impact-nox">Non-attainment area impact: NOx</h4>
<div class="cell" data-execution_count="47">
<pre class="python3 cell-code"><code>ppt_non_att_nox = non_att_area_emis_nox.drop(columns="COG").rename(
    columns={
        "COG_ABRVN": "COG",
        "county": "County",
        "emission_quant_fy22": "NOx Emission 2020 + FY22 VMT-Mix",
        "emission_quant_fy23": "NOx Emission 2020 + FY23 VMT-Mix",
        "emission_quant_diff_fy23_fy22": "FY23 - FY22 NOx",
        "emission_quant_perdiff_fy23_fy22": "FY23 vs. FY22 NOx (% diff)",
    }
)

ppt_non_att_nox = (
    ppt_non_att_nox[
        [
            "COG",
            "County",
            "NOx Emission 2020 + FY22 VMT-Mix",
            "NOx Emission 2020 + FY23 VMT-Mix",
            "FY23 - FY22 NOx",
            "FY23 vs. FY22 NOx (% diff)",
        ]
    ]
    .sort_values(["NOx Emission 2020 + FY22 VMT-Mix"], ascending=False)
    .reset_index(drop=True)
)
ppt_non_att_nox[
    [
        "COG",
        "NOx Emission 2020 + FY22 VMT-Mix",
        "NOx Emission 2020 + FY23 VMT-Mix",
        "FY23 - FY22 NOx",
        "FY23 vs. FY22 NOx (% diff)",
    ]
] = ppt_non_att_nox[
    [
        "COG",
        "NOx Emission 2020 + FY22 VMT-Mix",
        "NOx Emission 2020 + FY23 VMT-Mix",
        "FY23 - FY22 NOx",
        "FY23 vs. FY22 NOx (% diff)",
    ]
].round(
    2
)
path_out = r"E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/ppt_non_att_nox.csv"
ppt_non_att_nox.to_csv(path_out, index=False)
</code></pre>
</div>
<div class="cell" data-execution_count="48">
<pre class="python3 cell-code"><code>%%R -i non_att_area_emis_nox -w 600 
require(ggplot2)
require(awtools)
p = ggplot(data=non_att_area_emis_nox, aes(x=COG_ABRVN, y=emission_quant_perdiff_fy23_fy22, fill=COG_ABRVN)) + geom_boxplot(outlier.colour="black", outlier.shape=16,outlier.size=2, notch=FALSE) + 
theme_bw(base_size = 16) + theme(legend.position="none", axis.text.x=element_text(angle=45,hjust=1)) + labs(x = "COG", y = "NOx Emission Increase (%) by County")
path_fig_out = "E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/nox_nonatt_fy23_fy22_PerDiff.png"
ggsave(path_fig_out)
p</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code>Saving 8.33 x 6.67 in image</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="aerr_impact_fy23_files/figure-html/cell-49-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="49">
<pre class="python3 cell-code"><code>%%R -i non_att_area_emis_nox -w 600 
require(ggplot2)
require(awtools)
p = ggplot(data=non_att_area_emis_nox, aes(x=COG_ABRVN, y=emission_quant_diff_fy23_fy22, fill=COG_ABRVN)) + geom_boxplot(outlier.colour="black", outlier.shape=16,outlier.size=2, notch=FALSE) + 
theme_bw(base_size = 16) + theme(legend.position="none", axis.text.x=element_text(angle=45,hjust=1)) + labs(x = "COG", y = "NOx Emission Increase (short-tons/day) by County")
path_fig_out = "E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/nox_nonatt_fy23_fy22_Diff.png"
ggsave(path_fig_out)
p</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code>Saving 8.33 x 6.67 in image</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="aerr_impact_fy23_files/figure-html/cell-50-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="50">
<pre class="python3 cell-code"><code>non_att_area_emis_1.groupby(
    ["COG_ABRVN", "eis_poll_nei17"]
).emission_quant_perdiff_fy23_fy22.describe()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="50">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">COG_ABRVN</th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AACOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>1.00000</td>
<td>7.37698</td>
<td>NaN</td>
<td>7.37698</td>
<td>7.37698</td>
<td>7.37698</td>
<td>7.37698</td>
<td>7.37698</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ATCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>-0.41841</td>
<td>NaN</td>
<td>-0.41841</td>
<td>-0.41841</td>
<td>-0.41841</td>
<td>-0.41841</td>
<td>-0.41841</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ETCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>3.00000</td>
<td>-0.67405</td>
<td>1.91652</td>
<td>-2.88475</td>
<td>-1.27049</td>
<td>0.34377</td>
<td>0.43130</td>
<td>0.51882</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HGAC</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>8.00000</td>
<td>-5.61959</td>
<td>3.40571</td>
<td>-10.19449</td>
<td>-8.05095</td>
<td>-6.47398</td>
<td>-2.44968</td>
<td>-1.21974</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HOTCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>-2.00283</td>
<td>NaN</td>
<td>-2.00283</td>
<td>-2.00283</td>
<td>-2.00283</td>
<td>-2.00283</td>
<td>-2.00283</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">NCTCOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>10.00000</td>
<td>-3.95714</td>
<td>5.10097</td>
<td>-13.62174</td>
<td>-6.81500</td>
<td>-2.88244</td>
<td>-1.11507</td>
<td>3.38821</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>-0.42292</td>
<td>NaN</td>
<td>-0.42292</td>
<td>-0.42292</td>
<td>-0.42292</td>
<td>-0.42292</td>
<td>-0.42292</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PBRPC</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>-1.58857</td>
<td>NaN</td>
<td>-1.58857</td>
<td>-1.58857</td>
<td>-1.58857</td>
<td>-1.58857</td>
<td>-1.58857</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PRPC</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>-3.19758</td>
<td>NaN</td>
<td>-3.19758</td>
<td>-3.19758</td>
<td>-3.19758</td>
<td>-3.19758</td>
<td>-3.19758</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">RIOCOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>1.00000</td>
<td>-4.11543</td>
<td>NaN</td>
<td>-4.11543</td>
<td>-4.11543</td>
<td>-4.11543</td>
<td>-4.11543</td>
<td>-4.11543</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PM10-PRI</td>
<td>1.00000</td>
<td>-2.86380</td>
<td>NaN</td>
<td>-2.86380</td>
<td>-2.86380</td>
<td>-2.86380</td>
<td>-2.86380</td>
<td>-2.86380</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="51">
<pre class="python3 cell-code"><code>non_att_area_emis_1.groupby(
    ["COG_ABRVN", "eis_poll_nei17"]
).emission_quant_fy22.describe()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="51">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">count</th>
<th data-quarto-table-cell-role="th">mean</th>
<th data-quarto-table-cell-role="th">std</th>
<th data-quarto-table-cell-role="th">min</th>
<th data-quarto-table-cell-role="th">25%</th>
<th data-quarto-table-cell-role="th">50%</th>
<th data-quarto-table-cell-role="th">75%</th>
<th data-quarto-table-cell-role="th">max</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">COG_ABRVN</th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">AACOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>1.00000</td>
<td>21.17179</td>
<td>NaN</td>
<td>21.17179</td>
<td>21.17179</td>
<td>21.17179</td>
<td>21.17179</td>
<td>21.17179</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">ATCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>0.00435</td>
<td>NaN</td>
<td>0.00435</td>
<td>0.00435</td>
<td>0.00435</td>
<td>0.00435</td>
<td>0.00435</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">ETCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>3.00000</td>
<td>0.00327</td>
<td>0.00034</td>
<td>0.00290</td>
<td>0.00312</td>
<td>0.00334</td>
<td>0.00345</td>
<td>0.00357</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">HGAC</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>8.00000</td>
<td>7.43904</td>
<td>12.01991</td>
<td>1.43983</td>
<td>1.98440</td>
<td>3.39037</td>
<td>4.96373</td>
<td>36.95107</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">HOTCOG</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>0.00524</td>
<td>NaN</td>
<td>0.00524</td>
<td>0.00524</td>
<td>0.00524</td>
<td>0.00524</td>
<td>0.00524</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">NCTCOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>10.00000</td>
<td>7.22123</td>
<td>7.14691</td>
<td>1.30130</td>
<td>3.58640</td>
<td>4.28939</td>
<td>6.78557</td>
<td>23.91621</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>0.00643</td>
<td>NaN</td>
<td>0.00643</td>
<td>0.00643</td>
<td>0.00643</td>
<td>0.00643</td>
<td>0.00643</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">PBRPC</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>0.00432</td>
<td>NaN</td>
<td>0.00432</td>
<td>0.00432</td>
<td>0.00432</td>
<td>0.00432</td>
<td>0.00432</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PRPC</td>
<td data-quarto-table-cell-role="th">SO2</td>
<td>1.00000</td>
<td>0.00126</td>
<td>NaN</td>
<td>0.00126</td>
<td>0.00126</td>
<td>0.00126</td>
<td>0.00126</td>
<td>0.00126</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">RIOCOG</td>
<td data-quarto-table-cell-role="th">NOX</td>
<td>1.00000</td>
<td>11.69539</td>
<td>NaN</td>
<td>11.69539</td>
<td>11.69539</td>
<td>11.69539</td>
<td>11.69539</td>
<td>11.69539</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">PM10-PRI</td>
<td>1.00000</td>
<td>1.12519</td>
<td>NaN</td>
<td>1.12519</td>
<td>1.12519</td>
<td>1.12519</td>
<td>1.12519</td>
<td>1.12519</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
<section id="non-attainment-area-impact-pm10" class="level4">
<h4 class="anchored" data-anchor-id="non-attainment-area-impact-pm10">Non-attainment area impact: PM10</h4>
<div class="cell" data-execution_count="52">
<pre class="python3 cell-code"><code>non_att_area_emis_1.eis_poll_nei17.unique()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="52">
<pre><code>array(['NOX', 'SO2', 'PM10-PRI'], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="53">
<pre class="python3 cell-code"><code>non_att_area_emis_pm10 = non_att_area_emis_1.loc[
    lambda df: df.eis_poll_nei17 == "PM10-PRI"
]
</code></pre>
</div>
<div class="cell" data-execution_count="54">
<pre class="python3 cell-code"><code>non_att_area_emis_pm10.T
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="54">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">28</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">COG_ABRVN</td>
<td>RIOCOG</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">COG</td>
<td>Rio Grande Council of Governments</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">eis_poll_nei17</td>
<td>PM10-PRI</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Non-Attainment Status</td>
<td>8-Hour Ozone (2015) [Marginal], PM-10 (1987) [...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">District</td>
<td>El Paso</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">county</td>
<td>El Paso</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">fips</td>
<td>48141</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">district</td>
<td>El Paso</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">vmt_mix_dp</td>
<td>4.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">vmt_mix_fy22</td>
<td>4.00000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">vmt_mix_fy23</td>
<td>4.00000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">vmt_dp</td>
<td>6,816,681,022.64000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">vmt_fy22</td>
<td>6,816,681,022.64000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">vmt_fy23</td>
<td>6,816,681,022.64000</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">emission_quant_dp</td>
<td>1.22856</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">emission_quant_fy22</td>
<td>1.12519</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">emission_quant_fy23</td>
<td>1.09296</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">emission_quant_diff_fy23_fy22</td>
<td>-0.03222</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">emission_quant_perdiff_fy23_fy22</td>
<td>-2.86380</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section>
</section>
</section>
<section id="county-emission-inc-w.r.t-to-vmt-mix-and-vmt-change-emission-rate" class="level2">
<h2 class="anchored" data-anchor-id="county-emission-inc-w.r.t-to-vmt-mix-and-vmt-change-emission-rate">County Emission Inc w.r.t to VMT-Mix and VMT Change + Emission Rate</h2>
<div class="cell" data-execution_count="55">
<pre class="python3 cell-code"><code>cnty_emis_by_vmt_mix = suft_emis_vmt_onroad_anly_1.loc[
    lambda df: df.eis_poll_nei17 == "NOX"
]
</code></pre>
</div>
<div class="cell" data-execution_count="56">
<pre class="python3 cell-code"><code>254 * 22 * 5 * 5
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="56">
<pre><code>139700</code></pre>
</div>
</div>
<div class="cell" data-execution_count="57">
<pre class="python3 cell-code"><code>test = cnty_emis_by_vmt_mix.groupby(
    ["road_type_id", "source_type_id", "fuel_type_id"]
).vmt_mix_dp.count()
</code></pre>
</div>
<div class="cell" data-execution_count="58">
<pre class="python3 cell-code"><code>cnty_emis_by_vmt_mix1 = (
    cnty_emis_by_vmt_mix.assign(
        vmt_mix_perdiff_fy23_fy22=lambda df: 100
        * (df.vmt_mix_fy23_13_21 - df.vmt_mix_fy22_13_19)
        / df.vmt_mix_fy22_13_19
    )
    .sort_values("vmt_mix_perdiff_fy23_fy22", ascending=False)
    .filter(
        items=[
            "eis_poll_nei17",
            "county",
            "district",
            "road_type_id",
            "sut_fueltype_lab",
            "vmt_mix_perdiff_fy23_fy22",
            "emission_rate_calc",
            "emission_quant_fy22",
            "emission_quant_fy23",
            "vmt_fy22",
            "vmt_fy23",
            "vmt_mix_fy22_13_19",
            "vmt_mix_fy23_13_21",
        ]
    )
)
sh_tn_to_grm = 907185
cnty_emis_by_vmt_mix1["vmt_mix_fy22_13_19"] = (
    cnty_emis_by_vmt_mix1["vmt_mix_fy22_13_19"] * 100
)
cnty_emis_by_vmt_mix1["vmt_mix_fy23_13_21"] = (
    cnty_emis_by_vmt_mix1["vmt_mix_fy23_13_21"] * 100
)
cnty_emis_by_vmt_mix1["emission_rate_calc_gm"] = (
    cnty_emis_by_vmt_mix1.emission_rate_calc * sh_tn_to_grm
)
cnty_emis_by_vmt_mix1["emission_quant_fy22_gm"] = (
    cnty_emis_by_vmt_mix1.emission_quant_fy22 * sh_tn_to_grm
)
cnty_emis_by_vmt_mix1["emission_quant_fy23_gm"] = (
    cnty_emis_by_vmt_mix1.emission_quant_fy23 * sh_tn_to_grm
)
cnty_emis_by_vmt_mix1["emission_quant_diff_fy23_fy22_gm"] = (
    cnty_emis_by_vmt_mix1.emission_quant_fy23_gm
    - cnty_emis_by_vmt_mix1.emission_quant_fy22_gm
)
cnty_emis_by_vmt_mix1["vmt_diff_fy23_fy22"] = (
    cnty_emis_by_vmt_mix1.vmt_fy23 - cnty_emis_by_vmt_mix1.vmt_fy22
)
cnty_emis_by_vmt_mix1 = cnty_emis_by_vmt_mix1.drop(
    columns=["emission_rate_calc", "emission_quant_fy22", "emission_quant_fy23"]
)
</code></pre>
</div>
<div class="cell" data-execution_count="59">
<pre class="python3 cell-code"><code>cnty_emis_by_vmt_mix1.vmt_mix_fy23_13_21.describe()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="59">
<pre><code>count   13,090.00000
mean         4.54545
std         12.01765
min          0.00006
25%          0.05180
50%          0.19749
75%          1.91519
max         73.18006
Name: vmt_mix_fy23_13_21, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="60">
<pre class="python3 cell-code"><code>cnty_emis_by_vmt_mix1.vmt_mix_fy23_13_21.describe()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="60">
<pre><code>count   13,090.00000
mean         4.54545
std         12.01765
min          0.00006
25%          0.05180
50%          0.19749
75%          1.91519
max         73.18006
Name: vmt_mix_fy23_13_21, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="61">
<pre class="python3 cell-code"><code>cnty_emis_by_vmt_mix1[
    [
        "vmt_mix_perdiff_fy23_fy22",
        "vmt_fy22",
        "vmt_fy23",
        "vmt_mix_fy22_13_19",
        "vmt_mix_fy23_13_21",
        "emission_rate_calc_gm",
        "emission_quant_fy22_gm",
        "emission_quant_fy23_gm",
        "emission_quant_diff_fy23_fy22_gm",
        "vmt_diff_fy23_fy22",
    ]
] = cnty_emis_by_vmt_mix1[
    [
        "vmt_mix_perdiff_fy23_fy22",
        "vmt_fy22",
        "vmt_fy23",
        "vmt_mix_fy22_13_19",
        "vmt_mix_fy23_13_21",
        "emission_rate_calc_gm",
        "emission_quant_fy22_gm",
        "emission_quant_fy23_gm",
        "emission_quant_diff_fy23_fy22_gm",
        "vmt_diff_fy23_fy22",
    ]
].round(
    2
)
</code></pre>
</div>
<div class="cell" data-execution_count="62">
<pre class="python3 cell-code"><code>emis_comp_pol_cnty.groupby(["eis_poll_nei17", "county", "district"])
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="62">
<pre><code>&lt;pandas.core.groupby.generic.DataFrameGroupBy object at 0x000001EB9418D2B0&gt;</code></pre>
</div>
</div>
<div class="cell" data-execution_count="63">
<pre class="python3 cell-code"><code>cnty_emis_filt = (
    emis_comp_pol_cnty.loc[lambda df: df.eis_poll_nei17 == "NOX"]
    .filter(
        items=[
            "eis_poll_nei17",
            "county",
            "district",
            "emission_quant_fy22",
            "emission_quant_fy23",
            "emission_quant_diff_fy23_fy22",
            "emission_quant_perdiff_fy23_fy22",
        ]
    )
    .sort_values("emission_quant_perdiff_fy23_fy22", ascending=False)
    .reset_index(drop=True)
)
</code></pre>
</div>
<div class="cell" data-execution_count="64">
<pre class="python3 cell-code"><code>cnty_emis_brkdn = cnty_emis_filt.merge(
    cnty_emis_by_vmt_mix1, on=["eis_poll_nei17", "county", "district"]
)
</code></pre>
</div>
<p>Focus on the counties with the largest percent change and show what is happing in the individual row (CLhT, PC, PT etc.). Show that +ve changes + -ve changes cancel each other. And that emission rates for heavy duty vehicles are quite high.</p>
<div class="cell" data-execution_count="65">
<pre class="python3 cell-code"><code>path_out = r"E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/cnty_emis_stats.csv"
cnty_emis_filt.to_csv(path_out, index=False)

path_out = r"E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/cnty_emis_stats_with_breakdown.csv"
cnty_emis_brkdn.to_csv(path_out, index=False)
</code></pre>
</div>
<div class="cell" data-execution_count="66">
<pre class="python3 cell-code"><code>cnty_top_5 = cnty_emis_filt.head(5)
cnty_tail_5 = cnty_emis_filt.tail(5)
cnty_top_5
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="66">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">emission_quant_fy22</th>
<th data-quarto-table-cell-role="th">emission_quant_fy23</th>
<th data-quarto-table-cell-role="th">emission_quant_diff_fy23_fy22</th>
<th data-quarto-table-cell-role="th">emission_quant_perdiff_fy23_fy22</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>NOX</td>
<td>Eastland</td>
<td>Brownwood</td>
<td>1.80382</td>
<td>2.28401</td>
<td>0.48018</td>
<td>26.62017</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>NOX</td>
<td>Tom Green</td>
<td>San Angelo</td>
<td>1.71839</td>
<td>1.99068</td>
<td>0.27229</td>
<td>15.84546</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>NOX</td>
<td>Frio</td>
<td>San Antonio</td>
<td>1.28760</td>
<td>1.48690</td>
<td>0.19930</td>
<td>15.47809</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>NOX</td>
<td>Brazos</td>
<td>Bryan</td>
<td>2.65934</td>
<td>3.06113</td>
<td>0.40179</td>
<td>15.10855</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>NOX</td>
<td>Atascosa</td>
<td>San Antonio</td>
<td>1.74840</td>
<td>1.98676</td>
<td>0.23835</td>
<td>13.63274</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="67">
<pre class="python3 cell-code"><code>cnty_tail_5
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="67">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">eis_poll_nei17</th>
<th data-quarto-table-cell-role="th">county</th>
<th data-quarto-table-cell-role="th">district</th>
<th data-quarto-table-cell-role="th">emission_quant_fy22</th>
<th data-quarto-table-cell-role="th">emission_quant_fy23</th>
<th data-quarto-table-cell-role="th">emission_quant_diff_fy23_fy22</th>
<th data-quarto-table-cell-role="th">emission_quant_perdiff_fy23_fy22</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">249</td>
<td>NOX</td>
<td>Archer</td>
<td>Wichita Falls</td>
<td>0.54289</td>
<td>0.45211</td>
<td>-0.09077</td>
<td>-16.72081</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">250</td>
<td>NOX</td>
<td>Jim Hogg</td>
<td>Pharr</td>
<td>0.16300</td>
<td>0.13560</td>
<td>-0.02740</td>
<td>-16.80737</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">251</td>
<td>NOX</td>
<td>Throckmorton</td>
<td>Wichita Falls</td>
<td>0.09979</td>
<td>0.08285</td>
<td>-0.01693</td>
<td>-16.97006</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">252</td>
<td>NOX</td>
<td>Jack</td>
<td>Fort Worth</td>
<td>0.24107</td>
<td>0.20012</td>
<td>-0.04095</td>
<td>-16.98792</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">253</td>
<td>NOX</td>
<td>Somervell</td>
<td>Fort Worth</td>
<td>0.22541</td>
<td>0.18708</td>
<td>-0.03833</td>
<td>-17.00596</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell" data-execution_count="68">
<pre class="python3 cell-code"><code>cnty_top_5 = cnty_top_5.rename(
    columns={
        "county": "County",
        "emission_quant_fy22": "NOx Emission 2020 + FY22 VMT-Mix",
        "emission_quant_fy23": "NOx Emission 2020 + FY23 VMT-Mix",
        "emission_quant_diff_fy23_fy22": "FY23 - FY22 NOx",
        "emission_quant_perdiff_fy23_fy22": "FY23 vs. FY22 NOx (% diff)",
    }
)
cnty_top_5 = cnty_top_5.round(2)
cnty_top_5.to_clipboard()
</code></pre>
</div>
<div class="cell" data-execution_count="69">
<pre class="python3 cell-code"><code>cnty_tail_5 = cnty_tail_5.rename(
    columns={
        "county": "County",
        "emission_quant_fy22": "NOx Emission 2020 + FY22 VMT-Mix",
        "emission_quant_fy23": "NOx Emission 2020 + FY23 VMT-Mix",
        "emission_quant_diff_fy23_fy22": "FY23 - FY22 NOx",
        "emission_quant_perdiff_fy23_fy22": "FY23 vs. FY22 NOx (% diff)",
    }
)
cnty_tail_5 = cnty_tail_5.round(2)
cnty_tail_5.to_clipboard()
</code></pre>
</div>
<div class="cell" data-execution_count="70">
<pre class="python3 cell-code"><code>cnty_emis_brkdn.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="70">
<pre><code>Index(['eis_poll_nei17', 'county', 'district', 'emission_quant_fy22',
       'emission_quant_fy23', 'emission_quant_diff_fy23_fy22',
       'emission_quant_perdiff_fy23_fy22', 'road_type_id', 'sut_fueltype_lab',
       'vmt_mix_perdiff_fy23_fy22', 'vmt_fy22', 'vmt_fy23',
       'vmt_mix_fy22_13_19', 'vmt_mix_fy23_13_21', 'emission_rate_calc_gm',
       'emission_quant_fy22_gm', 'emission_quant_fy23_gm',
       'emission_quant_diff_fy23_fy22_gm', 'vmt_diff_fy23_fy22'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="71">
<pre class="python3 cell-code"><code>cnty_emis_brkdn_top5 = cnty_emis_brkdn.loc[
    lambda df: df.county.isin(set(cnty_top_5.County))
]
cnty_emis_brkdn_tail5 = cnty_emis_brkdn.loc[
    lambda df: df.county.isin(set(cnty_tail_5.County))
]
</code></pre>
</div>
</section>
<section id="vmt-mix-comp" class="level2">
<h2 class="anchored" data-anchor-id="vmt-mix-comp">VMT-Mix Comp</h2>
<div class="cell" data-execution_count="73">
<pre class="python3 cell-code"><code>vmix_fy22 = (
    vmtmix_fy22_13_19.loc[lambda df: df.yearID == 2020]
    .drop_duplicates(
        [
            "txdot_dist",
            "district",
            "mvs_rdtype_nm",
            "mvs_rdtype",
            "dowagg",
            "yearID",
            "tod",
            "sourceTypeName",
            "sourceTypeID",
            "fuelTypeID",
            "fuelTypeDesc",
        ]
    )
    .drop(columns="fips")
)
vmix_fy23 = (
    vmtmix_fy23_13_21.loc[lambda df: df.yearID == 2020]
    .drop_duplicates(
        [
            "txdot_dist",
            "district",
            "mvs_rdtype_nm",
            "mvs_rdtype",
            "dowagg",
            "yearID",
            "tod",
            "sourceTypeName",
            "sourceTypeID",
            "fuelTypeID",
            "fuelTypeDesc",
        ]
    )
    .drop(columns="fips")
)
</code></pre>
</div>
<div class="cell" data-execution_count="74">
<pre class="python3 cell-code"><code>vmtmix_comp = vmix_fy22.merge(
    vmix_fy23,
    on=[
        "txdot_dist",
        "district",
        "mvs_rdtype_nm",
        "mvs_rdtype",
        "dowagg",
        "yearID",
        "tod",
        "sourceTypeName",
        "sourceTypeID",
        "fuelTypeID",
        "fuelTypeDesc",
    ],
    suffixes=["_fy22", "_fy23"],
)
vmtmix_comp.vmt_mix_fy22 = vmtmix_comp.vmt_mix_fy22 * 100
vmtmix_comp.vmt_mix_fy23 = vmtmix_comp.vmt_mix_fy23 * 100
</code></pre>
</div>
<div class="cell" data-execution_count="75">
<pre class="python3 cell-code"><code>vmtmix_comp["vmt_mix_diff_fy23_fy22"] = (
    vmtmix_comp.vmt_mix_fy23 - vmtmix_comp.vmt_mix_fy22
)
vmtmix_comp["vmt_mix_perdiff_fy23_fy22"] = (
    100 * vmtmix_comp.vmt_mix_diff_fy23_fy22 / vmtmix_comp.vmt_mix_fy22
)
vmtmix_comp = vmtmix_comp.sort_values(
    "vmt_mix_perdiff_fy23_fy22", ascending=False
).reset_index(drop=True)
</code></pre>
</div>
<p>Look in the districts with the most change and see what offsets large +ve values (hint: PC, PT,…)</p>
<div class="cell" data-execution_count="76">
<pre class="python3 cell-code"><code>vmtmix_comp.columns
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>Index(['dgcode_fy22', 'txdot_dist', 'district', 'mvs_rdtype_nm', 'mvs_rdtype',
       'dowagg', 'yearID', 'tod', 'sourceTypeName', 'sourceTypeID',
       'fuelTypeID', 'fuelTypeDesc', 'vmt_mix_fy22', 'dgcode_fy23',
       'vmt_mix_fy23', 'vmt_mix_diff_fy23_fy22', 'vmt_mix_perdiff_fy23_fy22'],
      dtype='object')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="77">
<pre class="python3 cell-code"><code>len(
    vmtmix_comp[
        [
            "sourceTypeID",
            "fuelTypeID",
        ]
    ].drop_duplicates()
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="77">
<pre><code>24</code></pre>
</div>
</div>
<div class="cell" data-execution_count="78">
<pre class="python3 cell-code"><code>5 * 5 * 4 * 25 * 24
# 5 TOD, 5 Rd Type, 5 Day Type, 25 Districts, 24 SUTFT
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="78">
<pre><code>60000</code></pre>
</div>
</div>
<div class="cell" data-execution_count="79">
<pre class="python3 cell-code"><code>%%R -i vmtmix_comp -w 600 
require(ggplot2)
require(awtools)
p = ggplot(data=vmtmix_comp, aes(x=vmt_mix_perdiff_fy23_fy22)) + geom_histogram() + 
theme_bw(base_size = 16) + theme(legend.position="none", axis.text.x=element_text(angle=45,hjust=1)) + labs(x = "VMT-Mix FY22 vs. FY23 % Difference", y = "Count",) + a_flat_fill()
path_fig_out = "E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/vmt_mix_perdiff_fy23_fy22.png"
ggsave(path_fig_out)
p</code></pre>
<div class="cell-output cell-output-stdout">
<pre><code>Saving 8.33 x 6.67 in image
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
`stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="aerr_impact_fy23_files/figure-html/cell-79-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="80">
<pre class="python3 cell-code"><code>%%R -i vmtmix_comp -w 600 
require(ggplot2)
require(awtools)
p = ggplot(data=vmtmix_comp, aes(x=vmt_mix_perdiff_fy23_fy22)) + stat_ecdf() + 
theme_bw(base_size = 16) + theme(legend.position="none", axis.text.x=element_text(angle=45,hjust=1)) + labs(x = "VMT-Mix FY22 vs. FY23 % Difference", y = "Count",) + scale_x_continuous(breaks=c(-100, -50, -10, 10, 50,800)) + a_flat_fill()
path_fig_out = "E:/Texas A&amp;M Transportation Institute/TxDOT_TPP_Projects - Task 5.3 Activity Forecasting Factors/Tasks/VMT_Mix/Presentation/vmt_mix_perdiff_fy23_fy22_ecdf.png"
ggsave(path_fig_out)
p</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp.vmt_mix_perdiff_fy23_fy22.describe()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="92">
<pre><code>count   60,000.00000
mean         3.19081
std         29.43275
min        -87.21002
25%         -6.01294
50%          2.38563
75%          9.13917
max        758.98984
Name: vmt_mix_perdiff_fy23_fy22, dtype: float64</code></pre>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp.vmt_mix_perdiff_fy23_fy22.quantile(0.05)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="94">
<pre><code>-24.676715536264886</code></pre>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp.vmt_mix_perdiff_fy23_fy22.quantile(0.99)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="103">
<pre><code>66.81256965018005</code></pre>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig = vmtmix_comp.loc[lambda df: df.vmt_mix_perdiff_fy23_fy22 &gt;= 66.8]
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig.district.unique()
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="107">
<pre><code>array(['San Angelo', 'Bryan', 'Corpus Christi', 'Lubbock', 'Brownwood',
       'San Antonio', 'Wichita Falls', 'Amarillo', 'Waco', 'Dallas'],
      dtype=object)</code></pre>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig1 = vmtmix_comp_dig.drop_duplicates(
    ["district", "sourceTypeName", "fuelTypeDesc"]
)
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig1.groupby(["sourceTypeName", "fuelTypeDesc"]).agg(
    district=("district", set)
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="122">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sourceTypeName</th>
<th data-quarto-table-cell-role="th">fuelTypeDesc</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Combination Long-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Waco, San Angelo, San Antonio, Brownwood}</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Combination Short-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Waco, San Angelo, San Antonio, Brownwood}</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Bryan, Waco, San Angelo, San Antonio, Brownwood}</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Motor Home</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Motorcycle</td>
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{San Angelo}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Other Buses</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Refuse Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">School Bus</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Single Unit Long-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Single Unit Short-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Bryan, Brownwood}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Transit Bus</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Amarillo, Lubbock, San Angelo, Dallas, Corpus...</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig_low = vmtmix_comp.loc[lambda df: df.vmt_mix_perdiff_fy23_fy22 &lt;= -50]
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig_low1 = vmtmix_comp_dig_low.drop_duplicates(
    ["district", "sourceTypeName", "fuelTypeDesc"]
)
vmtmix_comp_dig_low1.groupby(["sourceTypeName", "fuelTypeDesc"]).agg(
    district=("district", set)
)
</code></pre>
<div class="cell-output cell-output-display" data-execution_count="134">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">district</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">sourceTypeName</th>
<th data-quarto-table-cell-role="th">fuelTypeDesc</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">Combination Long-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Atlanta}</td>
</tr>
<tr class="even">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Combination Short-haul Truck</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Atlanta}</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Atlanta}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Motorcycle</td>
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Tyler, Paris}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Other Buses</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">School Bus</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
<tr class="odd">
<td rowspan="2" data-quarto-table-cell-role="th" data-valign="top">Transit Bus</td>
<td data-quarto-table-cell-role="th">Diesel Fuel</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">Gasoline</td>
<td>{Waco, Brownwood, Tyler, Paris}</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>vmtmix_comp_dig_low2 = (
    vmtmix_comp_dig_low1.groupby(["sourceTypeName", "fuelTypeDesc"], as_index=False)
    .agg(district=("district", set))
    .values
)
</code></pre>
</div>
</section>
<section id="rpython-example" class="level2">
<h2 class="anchored" data-anchor-id="rpython-example">R+Python Example</h2>
<div class="cell">
<pre class="python3 cell-code"><code>import seaborn.objects as so
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code>sns.set_theme(style="whitegrid")
fig, ax = plt.subplots(1, 1)
sns.barplot(st_emis, x="Pollutants", y="FY23 vs. FY22 Emissions (%)", ax=ax)
ax.set_xlabel("Pollutants")
ax.set_ylabel("Emission Percent Diff")
fig.tight_layout()
fig.autofmt_xdate()
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code># # https://github.com/rpy2/rpy2/blob/master/doc/notebooks/introduction_nb.md
# import rpy2.robjects as robjects
# # R package names
# packnames = ('ggplot2',)

# # import rpy2's package module
# import rpy2.robjects.packages as rpackages

# if all(rpackages.isinstalled(x) for x in packnames):
#     have_tutorial_packages = True
# else:
#     have_tutorial_packages = False
# have_tutorial_packages
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code># if not have_tutorial_packages:
#     # R vector of strings
#     from rpy2.robjects.vectors import StrVector
#     # file
#     packnames_to_install = [x for x in packnames if not rpackages.isinstalled(x)]
#     if len(packnames_to_install) &gt; 0:
#         utils.install_packages(StrVector(packnames_to_install))
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code># # https://github.com/rpy2/rpy2/blob/master/doc/notebooks/jupyter.md
# from rpy2.robjects.packages import importr
# import rpy2.robjects.lib.ggplot2 as gp
# from rpy2.ipython.ggplot import image_png
# from rpy2.robjects import rl
</code></pre>
</div>
<div class="cell">
<pre class="python3 cell-code"><code># p = (gp.ggplot(data=rl("st_emis")) + gp.aes(x=rl("Pollutant"), y=rl("emission_quant_perdiff_fy22_dp")) + gp.geom_col()  + gp.labs(x = "Pollutants", y = "Emission Percent Difference")) + gp.theme_light(base_size = 14) +  gp.theme(axis_text_x=gp.element_text(angle=45,hjust=1))
# #image_png(p, width=600)
</code></pre>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>